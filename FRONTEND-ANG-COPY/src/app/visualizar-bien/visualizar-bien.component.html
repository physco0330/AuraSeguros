<div class="container">
  <main class="main-content">
    <h2 class="mb-4">Detalles del Bien</h2>
    <button (click)="regresar()" class="btn btn-primary mt-4">Regresar</button>

    <!-- Detalles del bien -->
    <div *ngIf="bienes.length > 0; else noData" class="card p-3">
      <div *ngFor="let bien of bienes" class="row mb-3">
        <div class="col-md-6">
          <div class="mb-2"><strong>ID:</strong> <span>{{ bien.idBien }}</span></div>
          <div class="mb-2"><strong>Código:</strong> <span>{{ bien.codigo }}</span></div>
          <div class="mb-2"><strong>Artículo:</strong> <span>{{ bien.articuloBienes }}</span></div>
          <div class="mb-2"><strong>Proceso:</strong> <span>{{ bien.procesoEstaciones }}</span></div>
          <div class="mb-2"><strong>Cantidad:</strong> <span>{{ bien.cantidad }}</span></div>
          <div class="mb-2"><strong>Descripción Artículo:</strong> <span>{{ bien.descripcionArticulo }}</span></div>
          <div class="mb-2"><strong>Descripción Movimiento:</strong> <span>{{ bien.descripcionMovimiento }}</span></div>
          <div class="mb-2"><strong>Estado:</strong> <span>{{ bien.estado }}</span></div>
        </div>
        <div class="col-md-6">
          <div class="mb-2"><strong>Riesgo:</strong> <span>{{ bien.riesgo }}</span></div>
          <div class="mb-2"><strong>Fecha Ingreso:</strong> <span>{{ bien.fechaIngreso | date:'dd/MM/yyyy' }}</span></div>
          <div class="mb-2"><strong>Fecha Modificación:</strong> <span>{{ bien.fechaModificacion | date:'dd/MM/yyyy HH:mm' }}</span></div>
          <div class="mb-2"><strong>Vr Unitario 2023:</strong> <span>{{ bien.vrUnitario2023 }}</span></div>
          <div class="mb-2"><strong>Vr Asegurado:</strong> <span>{{ bien.vrAsegurado }}</span></div>
          <div class="mb-2"><strong>Porcentaje IVA:</strong> <span>{{ bien.porcentajeIva }}</span></div>
          <div class="mb-2"><strong>IVA Variable:</strong> <span>{{ bien.ivaVariable }}</span></div>
          <div class="mb-2"><strong>Vr Asegurable:</strong> <span>{{ bien.vrAsegurable }}</span></div>
          <div class="mb-2"><strong>Tasa General:</strong> <span>{{ bien.tasaGeneral }}</span></div>
          <div class="mb-2"><strong>Prima:</strong> <span>{{ bien.prima }}</span></div>
          <div class="mb-2"><strong>Tasa IVA:</strong> <span>{{ bien.tasaIva }}</span></div>
          <div class="mb-2"><strong>Prima IVA Anual:</strong> <span>{{ bien.primaIvaAnual }}</span></div>
          <div class="mb-2"><strong>Prima Anual Total:</strong> <span>{{ bien.primaAnualTotal }}</span></div>
          <div class="mb-2"><strong>Beneficiario Adicional:</strong> <span>{{ bien.beneficiarioAdicional }}</span></div>
          <div class="mb-2"><strong>Número Endoso:</strong> <span>{{ bien.numeroEndoso }}</span></div>
          <div class="mb-2"><strong>Valor Endoso:</strong> <span>{{ bien.valorEndoso }}</span></div>
          <div class="mb-2"><strong>Vigencia Endoso:</strong> <span>{{ bien.vigenciaEndoso }}</span></div>
          <div class="mb-2"><strong>Banco:</strong> <span>{{ bien.banco }}</span></div>
          <div class="mb-2"><strong>NIT Banco:</strong> <span>{{ bien.nitBanco }}</span></div>
        </div>
      </div>
    </div>

    <!-- Botón agregar historial -->
    <div class="mt-3" *ngIf="token?.rolUsuario === 'admin'">
      <button class="btn btn-success mb-2" (click)="agregarHistorial()">Agregar Historial</button>
    </div>

    <!-- Filtro por fechas -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label>Fecha Inicio</label>
        <input type="date" [(ngModel)]="fechaFiltroInicio" class="form-control" />
      </div>
      <div class="col-md-3">
        <label>Fecha Fin</label>
        <input type="date" [(ngModel)]="fechaFiltroFin" class="form-control" />
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary" (click)="filtrarPorFechas()">Filtrar</button>
      </div>
    </div>

    <!-- Historial de seguros -->
    <div *ngIf="historialSeguros.length > 0; else noSeguros" class="mt-4">
      <h3>Historial de Seguros</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th *ngIf="token?.rolUsuario === 'admin'">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let seguro of historialSeguros">
            <td>{{ seguro.fechaInicioSeguro | date:'yyyy-MM-dd' }}</td>
            <td>{{ seguro.fechaFinSeguro | date:'yyyy-MM-dd' }}</td>
            <td>{{ seguro.descripcion }}</td>
            <td>{{ seguro.estadoSeguro }}</td>
            <td *ngIf="token?.rolUsuario === 'admin'">
              <button class="btn btn-warning btn-sm" (click)="abrirEditarHistorial(seguro)">Editar</button>
<button class="btn btn-danger btn-sm" (click)="eliminarHistorial(seguro)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Formulario de edición -->
      <div *ngIf="historialEdit" class="card p-3 mt-3">
        <h4>Editando Historial</h4>

        <label>Descripción:</label>
        <input [(ngModel)]="historialEdit.descripcion" class="form-control mb-2" />

        <label>Fecha Inicio:</label>
        <input type="date" [(ngModel)]="historialEdit.fechaInicioSeguro" class="form-control mb-2" />

        <label>Fecha Fin:</label>
        <input type="date" [(ngModel)]="historialEdit.fechaFinSeguro" class="form-control mb-2" />

        <label>Estado:</label>
        <select [(ngModel)]="historialEdit.estadoSeguro" class="form-select mb-2">
          <option value="Activo">Activo</option>
          <option value="Vencido">Vencido</option>
        </select>

        <div class="mt-2">
          <button class="btn btn-primary me-2" (click)="guardarEdicionHistorial()">Guardar</button>
          <button class="btn btn-secondary" (click)="cancelarEdicionHistorial()">Cancelar</button>
        </div>
      </div>

      <div class="mt-3">
        Veces que ha adquirido el seguro: <strong>{{ historialSeguros.length }}</strong>
      </div>
    </div>

    <ng-template #noSeguros>
      <div class="alert alert-info mt-4" role="alert">
        No hay historial de seguros disponible.
      </div>
    </ng-template>

    <ng-template #noData>
      <div class="alert alert-warning mt-4" role="alert">
        No hay historial disponible para el bien.
      </div>
    </ng-template>
  </main>
</div>
