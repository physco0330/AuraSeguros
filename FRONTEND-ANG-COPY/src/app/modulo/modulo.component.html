<div class="modulo-container">
  <!-- Contenedor principal de módulos -->
  <div class="welcome-message">
    <h2 class="welcome-title">Módulos</h2>
  </div>

  <div class="search-container">
    <input type="text" [(ngModel)]="searchTerm" placeholder="Buscar módulo..." />
  </div>

  <!-- Botón visible solo si el rol es admin -->
  <button
    class="btn-add-small"
    (click)="openModal()"
    *ngIf="token?.rolUsuario === 'admin'"
  >
    Agregar Módulo
  </button>

  <!-- Tarjeta fija para "Incendio" -->
  <div
    class="info-card info-card-incendio"
    [routerLink]="['/empresas']"
    routerLinkActive="active"
  >
    <div class="color-bar" style="background-color: #216280;"></div>
    <div class="card-content">
      <h4>Incendio</h4>
      <hr />
      <p>
        Este módulo brinda información relacionada con incidentes sobre
        incendios. Aquí podrás moverte libremente entre las empresas y realizar
        los cambios necesarios dentro de las tablas selectas.
      </p>
    </div>
  </div>

  <!-- Lista de módulos -->
  <div
    class="info-card-incendio"
    *ngFor="let modulo of filteredModulos()"
    (click)="navigateToEmpresas(modulo)"
  >
    <div
      class="color-bar"
      [style.background-color]="modulo.colorModulo"
    ></div>
    <div class="card-content">
      <div class="action-buttons">
        <button
          class="btn-editar"
          (click)="editModulo(modulo); $event.stopPropagation()"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          class="btn-eliminar"
          (click)="deleteModulo(modulo.id_modulo); $event.stopPropagation()"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <h4>{{ modulo.nombreModulo }}</h4>
      <hr />
      <p>{{ modulo.descripcionModulo }}</p>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="isModalOpen">
    <div class="modal-content">
      <h3>Agregar Módulo</h3>
      <form (ngSubmit)="onSubmit()">
        <div>
          <label for="nombreModulo">Nombre del Módulo:</label>
          <input
            type="text"
            id="nombreModulo"
            [(ngModel)]="nuevoModulo.nombreModulo"
            name="nombreModulo"
            required
          />
        </div>
        <div>
          <label for="descripcionModulo">Descripción:</label>
          <textarea
            id="descripcionModulo"
            [(ngModel)]="nuevoModulo.descripcionModulo"
            name="descripcionModulo"
            required
          ></textarea>
        </div>
        <div>
          <label for="colorModulo">Color del Módulo:</label>
          <input
            type="color"
            id="colorModulo"
            [(ngModel)]="nuevoModulo.colorModulo"
            name="colorModulo"
            required
          />
        </div>
        <div class="button-container">
          <button
            type="button"
            class="btn-cancelar"
            (click)="closeModal()"
          >
            Cancelar
          </button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
